<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8" />
<title>ELS Interpreter with Button & Video</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #output { white-space: pre-wrap; margin-bottom: 20px; }
  #buttons button {
    margin-right: 10px;
    color: #fff;
    border: none;
    cursor: pointer;
  }
  video {
    display: block;
    margin-top: 15px;
    margin-bottom: 20px;
  }
</style>
</head>
<body>

<h1>ELS Interpreter - Button və Video funksiyaları</h1>

<pre id="output"></pre>
<div id="buttons"></div>
<div id="videos"></div>

<script>
const outputEl = document.getElementById("output");
const buttonsEl = document.getElementById("buttons");
const videosEl = document.getElementById("videos");

function printOutput(text) {
  outputEl.textContent += text + "\n";
}

function tokenize(input) {
  return input
    .replace(/\n/g, " ")
    .match(/"(.*?)"|button|video|let|if|else|print|\d+|true|false|[a-zA-Z_]\w*|==|!=|<=|>=|[+\-*/=<>{}();,]/g);
}

function parse(tokens) {
  let i = 0;
  function walk() {
    let token = tokens[i];
    
    if (token === "print") {
      i++;
      if (tokens[i++] !== "(") throw "print səhv: '(' gözlənilir";
      const value = tokens[i++];
      if (tokens[i++] !== ")") throw "print səhv: ')' gözlənilir";
      if (tokens[i++] !== ";") throw "print səhv: ';' gözlənilir";
      return { type: "Print", value: value.replace(/^"|"$/g, "") };
    }
    
    if (token === "let") {
      i++;
      const name = tokens[i++];
      if (tokens[i++] !== "=") throw "'=' gözlənilir";
      const value = tokens[i++];
      if (tokens[i++] !== ";") throw "';' gözlənilir";
      return { type: "Let", name, value: parseInt(value) };
    }
    
    if (token === "if") {
      i++;
      if (tokens[i++] !== "(") throw "'(' gözlənilir";
      const varName = tokens[i++];
      const operator = tokens[i++];
      const right = tokens[i++];
      if (tokens[i++] !== ")") throw "')' gözlənilir";
      if (tokens[i++] !== "{") throw "'{' gözlənilir";
      const body = [];
      while (tokens[i] !== "}") body.push(walk());
      i++;
      return { type: "If", varName, operator, right: parseInt(right), body };
    }
    
    if (token === "button") {
      i++;
      // button "Name", "link", "color", width, height;
      const name = tokens[i++];
      if (tokens[i++] !== ",") throw "button sintaksisi səhv: ',' gözlənilir";
      const url = tokens[i++];
      if (tokens[i++] !== ",") throw "button sintaksisi səhv: ',' gözlənilir";
      const color = tokens[i++];
      if (tokens[i++] !== ",") throw "button sintaksisi səhv: ',' gözlənilir";
      const width = tokens[i++];
      if (tokens[i++] !== ",") throw "button sintaksisi səhv: ',' gözlənilir";
      const height = tokens[i++];
      if (tokens[i++] !== ";") throw "button sintaksisi səhv: ';' gözlənilir";
      
      return {
        type: "Button",
        name: name.replace(/^"|"$/g, ""),
        url: url.replace(/^"|"$/g, ""),
        color: color.replace(/^"|"$/g, ""),
        width: parseInt(width),
        height: parseInt(height)
      };
    }
    
    if (token === "video") {
      i++;
      // video "file.mp4", width, height, controls, autoplay;
      const src = tokens[i++];
      if (tokens[i++] !== ",") throw "video sintaksisi səhv: ',' gözlənilir";
      const width = tokens[i++];
      if (tokens[i++] !== ",") throw "video sintaksisi səhv: ',' gözlənilir";
      const height = tokens[i++];
      if (tokens[i++] !== ",") throw "video sintaksisi səhv: ',' gözlənilir";
      const controls = tokens[i++];
      if (tokens[i++] !== ",") throw "video sintaksisi səhv: ',' gözlənilir";
      const autoplay = tokens[i++];
      if (tokens[i++] !== ";") throw "video sintaksisi səhv: ';' gözlənilir";
      
      return {
        type: "Video",
        src: src.replace(/^"|"$/g, ""),
        width: parseInt(width),
        height: parseInt(height),
        controls: controls === "true",
        autoplay: autoplay === "true"
      };
    }
    
    throw "Naməlum token: " + token;
  }
  
  const ast = [];
  while (i < tokens.length) ast.push(walk());
  return ast;
}

function run(ast, env = {}) {
  for (const node of ast) {
    if (node.type === "Print") {
      printOutput(node.value);
    } else if (node.type === "Let") {
      env[node.name] = node.value;
    } else if (node.type === "If") {
      const left = env[node.varName];
      const right = node.right;
      let ok = false;
      if (node.operator === ">") ok = left > right;
      if (node.operator === "<") ok = left < right;
      if (node.operator === "==") ok = left == right;
      if (ok) run(node.body, env);
    } else if (node.type === "Button") {
      const btn = document.createElement("button");
      btn.textContent = node.name;
      btn.style.backgroundColor = node.color;
      btn.style.width = node.width + "px";
      btn.style.height = node.height + "px";
      btn.style.color = "#fff";
      btn.style.border = "none";
      btn.style.cursor = "pointer";
      btn.onclick = () => window.open(node.url, "_blank");
      buttonsEl.appendChild(btn);
      buttonsEl.appendChild(document.createTextNode(" ")); // düymələr arası boşluq
    } else if (node.type === "Video") {
      const video = document.createElement("video");
      video.src = node.src;
      video.width = node.width;
      video.height = node.height;
      if (node.controls) video.controls = true;
      if (node.autoplay) {
        video.autoplay = true;
        video.muted = true;  // autoplay işləməsi üçün bəzi brauzerlərdə səs susdurulmalıdır
      }
      videosEl.appendChild(video);
    }
  }
}

// Əsas kodu fetch etmək, parse etmək və işə salmaq:
fetch("main.els")
  .then(res => {
    if (!res.ok) throw new Error("Fayl tapılmadı: main.els");
    return res.text();
  })
  .then(code => {
    try {
      const tokens = tokenize(code);
      const ast = parse(tokens);
      run(ast);
    } catch(e) {
      printOutput("Xəta: " + e);
    }
  })
  .catch(err => printOutput(err.message));
</script>

</body>
</html>
