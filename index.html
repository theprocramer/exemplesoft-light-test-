<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8" />
<title>ELS Interpreter with fetch</title>
</head>
<body>
<h1>ELS Dilinin İcraatı (GitHub Pages ilə .els faylı fetch)</h1>

<pre id="output"></pre>

<script>
const outputEl = document.getElementById("output");
function printOutput(text) {
  outputEl.textContent += text + "\n";
}

function tokenize(input) {
  return input
    .replace(/\n/g, " ")
    .match(/"(.*?)"|let|if|else|print|\d+|[a-zA-Z_]\w*|==|!=|<=|>=|[+\-*/=<>{}();]/g);
}

function parse(tokens) {
  let i = 0;
  function walk() {
    let token = tokens[i];
    if (token === "print") {
      i++;
      if (tokens[i++] !== "(") throw "print səhv: '(' gözlənilir";
      const value = tokens[i++];
      if (tokens[i++] !== ")") throw "print səhv: ')' gözlənilir";
      if (tokens[i++] !== ";") throw "print səhv: ';' gözlənilir";
      return { type: "Print", value: value.replace(/^"|"$/g, "") };
    }
    if (token === "let") {
      i++;
      const name = tokens[i++];
      if (tokens[i++] !== "=") throw "'=' gözlənilir";
      const value = tokens[i++];
      if (tokens[i++] !== ";") throw "';' gözlənilir";
      return { type: "Let", name, value: parseInt(value) };
    }
    if (token === "if") {
      i++;
      if (tokens[i++] !== "(") throw "'(' gözlənilir";
      const varName = tokens[i++];
      const operator = tokens[i++];
      const right = tokens[i++];
      if (tokens[i++] !== ")") throw "')' gözlənilir";
      if (tokens[i++] !== "{") throw "'{' gözlənilir";
      const body = [];
      while (tokens[i] !== "}") body.push(walk());
      i++;
      return { type: "If", varName, operator, right: parseInt(right), body };
    }
    throw "Naməlum token: " + token;
  }
  const ast = [];
  while (i < tokens.length) ast.push(walk());
  return ast;
}

function run(ast, env = {}) {
  for (const node of ast) {
    if (node.type === "Print") {
      printOutput(node.value);
    } else if (node.type === "Let") {
      env[node.name] = node.value;
    } else if (node.type === "If") {
      const left = env[node.varName];
      const right = node.right;
      let ok = false;
      if (node.operator === ">") ok = left > right;
      if (node.operator === "<") ok = left < right;
      if (node.operator === "==") ok = left == right;
      if (ok) run(node.body, env);
    }
  }
}

// GitHub Pages-də main.els faylını fetch et və icra et
fetch("main.els")
  .then(res => {
    if (!res.ok) throw new Error("Fayl tapılmadı: main.els");
    return res.text();
  })
  .then(code => {
    try {
      const tokens = tokenize(code);
      const ast = parse(tokens);
      run(ast);
    } catch(e) {
      printOutput("Xəta: " + e);
    }
  })
  .catch(err => printOutput(err.message));
</script>
</body>
</html>
